title: Semantic Version Calculator
summary: Calculate semantic version from conventional commits in monorepos
description: |
  Calculates next semantic version based on git commit history using
  conventional commits with scope-based filtering for monorepo support.

  ## Features

  - **Scope-based filtering**: Filter commits by scope to calculate versions for specific products
  - **Monorepo support**: Multiple products can share a commit history with independent versioning
  - **Conventional commits**: Parses `feat`, `fix`, and breaking changes to determine bump level

  ## How it works

  1. Finds the last git tag matching `{product}-v{semver}`
  2. Gets all commits since that tag
  3. Filters commits by the specified scopes
  4. Determines bump level (major/minor/patch/none) based on commit types
  5. Calculates and exports the next version

  ## Commit format

  The step recognizes conventional commit format:
  - `feat(scope):` triggers a minor bump
  - `fix(scope):` triggers a patch bump
  - `feat(scope)!:` or `BREAKING CHANGE:` in body triggers a major bump
  - Unscoped commits (e.g., `feat: ...`) match ALL products

  ## Tag format

  Tags must follow the pattern: `{product}-v{version}` (e.g., `myapp-v1.2.3`)

website: https://github.com/jimdowning-cyclops/semver-calc-go
source_code_url: https://github.com/jimdowning-cyclops/semver-calc-go
support_url: https://github.com/jimdowning-cyclops/semver-calc-go/issues

type_tags:
  - utility

is_always_run: false
is_skippable: false

toolkit:
  go:
    package_name: github.com/jimdowning-cyclops/semver-calc-go

inputs:
  - product: ""
    opts:
      title: "Product name"
      summary: "Product name for tag prefix lookup"
      description: |
        The product name used to find the last version tag.

        Tags are expected in the format `{product}-v{version}`.
        For example, if product is `myapp`, the step looks for tags like `myapp-v1.2.3`.
      is_required: true

  - scopes: ""
    opts:
      title: "Scopes"
      summary: "Comma-separated list of scopes to match"
      description: |
        Comma-separated list of conventional commit scopes to include.

        For example: `myapp,app,core`

        - Commits with matching scopes are included in version calculation
        - Unscoped conventional commits (e.g., `feat: ...`) match ALL products
        - Non-conventional commits are ignored
      is_required: true

outputs:
  - SEMVER_PRODUCT:
    opts:
      title: "Product name"
      summary: "The product name from the input"

  - SEMVER_CURRENT:
    opts:
      title: "Current version"
      summary: "Current version from last tag (or 0.0.0 if no tag exists)"

  - SEMVER_NEXT:
    opts:
      title: "Next version"
      summary: "Calculated next semantic version"

  - SEMVER_BUMP:
    opts:
      title: "Bump level"
      summary: "Version bump level: major, minor, patch, or none"

  - SEMVER_COMMITS:
    opts:
      title: "Commit count"
      summary: "Number of matching commits since last tag"
